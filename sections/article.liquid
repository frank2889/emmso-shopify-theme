{% comment %}
  Article Section - Single article layout with comments and related posts
  
  Features:
  - Hero image
  - Reading time estimate
  - Author info
  - Article content (optimized typography)
  - Tags
  - Social sharing
  - Comments section
  - Related articles
  
  Dependencies:
  - assets/article.css (reading-optimized typography)
  - snippets/css-variables.liquid (color system)
{% endcomment %}

{% render 'css-variables' %}
<link rel="stylesheet" href="{{ 'article.min.css' | asset_url }}">

<article class="article" data-article-wrapper>
  {%- comment %} Article Hero {% endcomment -%}
  <header class="article__header">
    {%- if article.image and section.settings.show_featured_image -%}
      <div class="article__hero-image">
        {% render 'image',
          image: article.image,
          sizes: '100vw',
          loading: 'eager'
        %}
      </div>
    {%- endif -%}

    <div class="article__header-content">
      {%- comment %} Breadcrumb {% endcomment -%}
      <nav class="article__breadcrumb" aria-label="Breadcrumb">
        <a href="{{ blog.url }}">{{ blog.title }}</a>
        <span class="article__breadcrumb-separator">/</span>
        <span>{{ article.title }}</span>
      </nav>

      {%- comment %} Article Title {% endcomment -%}
      <h1 class="article__title">{{ article.title }}</h1>

      {%- comment %} Article Meta {% endcomment -%}
      <div class="article__meta">
        {%- if section.settings.show_date -%}
          <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}" class="article__date">
            {{ article.published_at | date: '%B %d, %Y' }}
          </time>
        {%- endif -%}

        {%- if section.settings.show_author and article.author -%}
          <span class="article__author">
            {{ 'blog.by_author' | t: author: article.author }}
          </span>
        {%- endif -%}

        {%- if section.settings.show_reading_time -%}
          {%- assign words = article.content | strip_html | split: ' ' | size -%}
          {%- assign reading_time = words | divided_by: 200 | at_least: 1 -%}
          <span class="article__reading-time">
            {{ 'blog.reading_time' | t: minutes: reading_time }}
          </span>
        {%- endif -%}
      </div>

      {%- comment %} Article Tags {% endcomment -%}
      {%- if section.settings.show_tags and article.tags.size > 0 -%}
        <div class="article__tags">
          {%- for tag in article.tags -%}
            <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="article__tag">
              {{ tag }}
            </a>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
  </header>

  {%- comment %} Article Content {% endcomment -%}
  <div class="article__content">
    <div class="article__body rte">
      {{ article.content }}
    </div>
  </div>

  {%- comment %} Article Footer {% endcomment -%}
  <footer class="article__footer">
    {%- if section.settings.show_share_buttons -%}
      <div class="article__share">
        <p class="article__share-label">{{ 'blog.share_article' | t }}</p>
        <div class="article__share-buttons">
          <a 
            href="https://twitter.com/intent/tweet?text={{ article.title | url_encode }}&url={{ shop.url }}{{ article.url }}"
            target="_blank"
            rel="noopener"
            class="article__share-button"
            aria-label="Share on Twitter"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
            </svg>
          </a>
          <a 
            href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ article.url }}"
            target="_blank"
            rel="noopener"
            class="article__share-button"
            aria-label="Share on Facebook"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
            </svg>
          </a>
          <a 
            href="https://www.linkedin.com/shareArticle?mini=true&url={{ shop.url }}{{ article.url }}&title={{ article.title | url_encode }}"
            target="_blank"
            rel="noopener"
            class="article__share-button"
            aria-label="Share on LinkedIn"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/>
              <circle cx="4" cy="4" r="2"/>
            </svg>
          </a>
        </div>
      </div>
    {%- endif -%}

    <a href="{{ blog.url }}" class="article__back-link">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M10 3l-5 5 5 5" stroke="currentColor" stroke-width="2"/>
      </svg>
      {{ 'blog.back_to_blog' | t: blog_title: blog.title }}
    </a>
  </footer>

  {%- comment %} Comments Section {% endcomment -%}
  {%- if blog.comments_enabled? and section.settings.show_comments -%}
    <div class="article__comments">
      <h2 class="article__comments-title">
        {{ 'blog.comments_title' | t: count: article.comments_count }}
      </h2>

      {%- if article.comments_count > 0 -%}
        <div class="article__comments-list">
          {% paginate article.comments by 10 %}
            {% for comment in article.comments %}
              <div class="article-comment">
                <div class="article-comment__header">
                  <p class="article-comment__author">{{ comment.author }}</p>
                  <time datetime="{{ comment.created_at | date: '%Y-%m-%d' }}" class="article-comment__date">
                    {{ comment.created_at | date: '%B %d, %Y' }}
                  </time>
                </div>
                <div class="article-comment__content">
                  {{ comment.content }}
                </div>
              </div>
            {% endfor %}

            {%- if paginate.pages > 1 -%}
              <div class="article__comments-pagination">
                {{ paginate | default_pagination: anchor: 'comments' }}
              </div>
            {%- endif -%}
          {% endpaginate %}
        </div>
      {%- endif -%}

      {%- comment %} Comment Form {% endcomment -%}
      <div class="article__comment-form">
        <h3 class="article__comment-form-title">{{ 'blog.comment_form_title' | t }}</h3>

        {% form 'new_comment', article %}
          {%- if form.posted_successfully? -%}
            <div class="article__form-success" role="status">
              {%- if blog.moderated? -%}
                {{ 'blog.comment_moderated' | t }}
              {%- else -%}
                {{ 'blog.comment_posted' | t }}
              {%- endif -%}
            </div>
          {%- endif -%}

          {{ form.errors | default_errors }}

          <div class="article__form-field">
            <label for="comment-author">
              {{ 'blog.comment_form_name' | t }}
              <span class="required">*</span>
            </label>
            <input 
              type="text" 
              name="comment[author]" 
              id="comment-author"
              value="{{ form.author }}"
              required
              autocomplete="name"
            >
          </div>

          <div class="article__form-field">
            <label for="comment-email">
              {{ 'blog.comment_form_email' | t }}
              <span class="required">*</span>
            </label>
            <input 
              type="email" 
              name="comment[email]" 
              id="comment-email"
              value="{{ form.email }}"
              required
              autocomplete="email"
            >
          </div>

          <div class="article__form-field">
            <label for="comment-body">
              {{ 'blog.comment_form_body' | t }}
              <span class="required">*</span>
            </label>
            <textarea 
              name="comment[body]" 
              id="comment-body"
              rows="5"
              required
            >{{ form.body }}</textarea>
          </div>

          <button type="submit" class="article__form-submit">
            {{ 'blog.comment_form_submit' | t }}
          </button>
        {% endform %}
      </div>
    </div>
  {%- endif -%}

  {%- comment %} Related Articles {% endcomment -%}
  {%- if section.settings.show_related_articles -%}
    {%- assign related_articles = blog.articles | where_exp: "item", "item.id != article.id" | limit: 3 -%}
    {%- if related_articles.size > 0 -%}
      <div class="article__related">
        <h2 class="article__related-title">{{ 'blog.related_articles' | t }}</h2>
        <div class="article__related-grid">
          {%- for related_article in related_articles -%}
            <article class="related-article-card">
              {%- if related_article.image -%}
                <a href="{{ related_article.url }}" class="related-article-card__image">
                  {% render 'image',
                    image: related_article.image,
                    sizes: '(min-width: 990px) 300px, calc((100vw - 3rem) / 2)',
                    loading: 'lazy'
                  %}
                </a>
              {%- endif -%}
              <div class="related-article-card__content">
                <h3 class="related-article-card__title">
                  <a href="{{ related_article.url }}">{{ related_article.title }}</a>
                </h3>
                <time datetime="{{ related_article.published_at | date: '%Y-%m-%d' }}">
                  {{ related_article.published_at | date: '%B %d, %Y' }}
                </time>
              </div>
            </article>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  {%- endif -%}
</article>

{% schema %}
{
  "name": "t:general.article",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.article.settings.header__hero"
    },
    {
      "type": "checkbox",
      "id": "show_featured_image",
      "label": "t:sections.article.settings.show_featured_image.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.article.settings.header__meta"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "t:sections.article.settings.show_date.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "t:sections.article.settings.show_author.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reading_time",
      "label": "t:sections.article.settings.show_reading_time.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "t:sections.article.settings.show_tags.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.article.settings.header__sharing"
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "t:sections.article.settings.show_share_buttons.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.article.settings.header__comments"
    },
    {
      "type": "checkbox",
      "id": "show_comments",
      "label": "t:sections.article.settings.show_comments.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.article.settings.header__related"
    },
    {
      "type": "checkbox",
      "id": "show_related_articles",
      "label": "t:sections.article.settings.show_related_articles.label",
      "default": true
    }
  ]
}
{% endschema %}
