{% comment %}
  Password Section - Store under construction/maintenance page
  
  Features:
  - Password form with validation
  - Countdown timer (optional)
  - Email capture for launch notification
  - Social media links
  - Background image/video
  - Brand logo
  
  Dependencies:
  - assets/password.css (password page styling)
  - snippets/css-variables.liquid (color system)
{% endcomment %}

{% render 'css-variables' %}
<link rel="stylesheet" href="{{ 'password.min.css' | asset_url }}">

<div class="password-page" 
  {%- if section.settings.background_image %} 
    style="background-image: url('{{ section.settings.background_image | image_url: width: 1920 }}');"
  {%- endif -%}
>
  <div class="password-page__overlay"></div>
  
  <div class="password-page__container">
    {%- comment %} Logo {% endcomment -%}
    {%- if section.settings.logo -%}
      <div class="password-page__logo">
        {{ section.settings.logo | image_url: width: 300 | image_tag: 
          loading: 'eager',
          alt: shop.name
        }}
      </div>
    {%- else -%}
      <h1 class="password-page__store-name">{{ shop.name }}</h1>
    {%- endif -%}

    {%- comment %} Status Badge {% endcomment -%}
    {%- if section.settings.show_status_badge -%}
      <div class="password-page__badge">
        {{ section.settings.status_text | default: 'password.coming_soon' | t }}
      </div>
    {%- endif -%}

    {%- comment %} Main Content {% endcomment -%}
    <div class="password-page__content">
      <h2 class="password-page__title">
        {{ section.settings.heading | default: 'password.heading' | t }}
      </h2>
      
      {%- if shop.password_message or section.settings.message -%}
        <div class="password-page__message">
          {{ section.settings.message | default: shop.password_message }}
        </div>
      {%- endif -%}
    </div>

    {%- comment %} Countdown Timer {% endcomment -%}
    {%- if section.settings.show_countdown and section.settings.launch_date -%}
      <div class="password-page__countdown" 
        data-countdown="{{ section.settings.launch_date | date: '%Y-%m-%dT%H:%M:%S' }}"
      >
        <div class="password-page__countdown-item">
          <span class="password-page__countdown-value" data-days>0</span>
          <span class="password-page__countdown-label">{{ 'password.days' | t }}</span>
        </div>
        <div class="password-page__countdown-item">
          <span class="password-page__countdown-value" data-hours>0</span>
          <span class="password-page__countdown-label">{{ 'password.hours' | t }}</span>
        </div>
        <div class="password-page__countdown-item">
          <span class="password-page__countdown-value" data-minutes>0</span>
          <span class="password-page__countdown-label">{{ 'password.minutes' | t }}</span>
        </div>
        <div class="password-page__countdown-item">
          <span class="password-page__countdown-value" data-seconds>0</span>
          <span class="password-page__countdown-label">{{ 'password.seconds' | t }}</span>
        </div>
      </div>
    {%- endif -%}

    {%- comment %} Email Capture Form {% endcomment -%}
    {%- if section.settings.show_email_capture -%}
      <div class="password-page__email-capture">
        <h3 class="password-page__email-title">
          {{ 'password.notify_me' | t }}
        </h3>
        {% form 'customer', class: 'password-page__email-form' %}
          <input type="hidden" name="contact[tags]" value="newsletter,password-page">
          
          <div class="password-page__email-field">
            <label for="newsletter-email" class="visually-hidden">
              {{ 'password.email_placeholder' | t }}
            </label>
            <input 
              type="email" 
              name="contact[email]" 
              id="newsletter-email"
              placeholder="{{ 'password.email_placeholder' | t }}"
              required
              autocomplete="email"
            >
            <button type="submit" class="password-page__email-submit">
              {{ 'password.notify_submit' | t }}
            </button>
          </div>
          
          {%- if form.posted_successfully? -%}
            <p class="password-page__email-success">
              {{ 'password.notify_success' | t }}
            </p>
          {%- endif -%}
        {% endform %}
      </div>
    {%- endif -%}

    {%- comment %} Password Form {% endcomment -%}
    <div class="password-page__password-section">
      <button type="button" class="password-page__toggle-button" onclick="togglePasswordForm()">
        {{ 'password.enter_using_password' | t }}
      </button>
      
      <div class="password-page__password-form" id="password-form" style="display: none;">
        {% form 'storefront_password' %}
          {%- if form.errors -%}
            <div class="password-page__error">
              {{ form.errors | default_errors }}
            </div>
          {%- endif -%}

          <div class="password-page__form-field">
            <label for="password-input" class="visually-hidden">
              {{ 'password.password' | t }}
            </label>
            <input 
              type="password" 
              name="password" 
              id="password-input"
              placeholder="{{ 'password.password_placeholder' | t }}"
              autofocus
            >
            <button type="submit" class="password-page__form-submit">
              {{ 'password.enter' | t }}
            </button>
          </div>
        {% endform %}
      </div>
    </div>

    {%- comment %} Social Media Links {% endcomment -%}
    {%- if section.settings.show_social_links -%}
      <div class="password-page__social">
        {%- if settings.social_twitter_link != blank -%}
          <a href="{{ settings.social_twitter_link }}" class="password-page__social-link" target="_blank" rel="noopener">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
            </svg>
          </a>
        {%- endif -%}
        {%- if settings.social_facebook_link != blank -%}
          <a href="{{ settings.social_facebook_link }}" class="password-page__social-link" target="_blank" rel="noopener">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
            </svg>
          </a>
        {%- endif -%}
        {%- if settings.social_instagram_link != blank -%}
          <a href="{{ settings.social_instagram_link }}" class="password-page__social-link" target="_blank" rel="noopener">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
              <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/>
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
            </svg>
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- comment %} Admin Login {% endcomment -%}
    <div class="password-page__admin">
      <a href="/admin" class="password-page__admin-link">
        {{ 'password.store_owner' | t }}
      </a>
    </div>
  </div>
</div>

{%- comment %} Countdown Script {% endcomment -%}
{%- if section.settings.show_countdown and section.settings.launch_date -%}
  <script>
    function updateCountdown() {
      const countdown = document.querySelector('[data-countdown]');
      if (!countdown) return;
      
      const launchDate = new Date(countdown.dataset.countdown).getTime();
      const now = new Date().getTime();
      const distance = launchDate - now;
      
      if (distance < 0) {
        countdown.innerHTML = '<p class="password-page__countdown-ended">{{ 'password.launched' | t }}</p>';
        return;
      }
      
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      const daysEl = countdown.querySelector('[data-days]');
      const hoursEl = countdown.querySelector('[data-hours]');
      const minutesEl = countdown.querySelector('[data-minutes]');
      const secondsEl = countdown.querySelector('[data-seconds]');
      
      if (daysEl) daysEl.textContent = days;
      if (hoursEl) hoursEl.textContent = hours;
      if (minutesEl) minutesEl.textContent = minutes;
      if (secondsEl) secondsEl.textContent = seconds;
    }
    
    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
{%- endif -%}

<script>
  function togglePasswordForm() {
    const form = document.getElementById('password-form');
    const isHidden = form.style.display === 'none';
    form.style.display = isHidden ? 'block' : 'none';
    
    if (isHidden) {
      const input = form.querySelector('input[type="password"]');
      if (input) input.focus();
    }
  }
</script>

{% schema %}
{
  "name": "t:general.password",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.password.settings.header__branding"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:sections.password.settings.logo.label"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "t:sections.password.settings.background_image.label"
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__content"
    },
    {
      "type": "checkbox",
      "id": "show_status_badge",
      "label": "t:sections.password.settings.show_status_badge.label",
      "default": true
    },
    {
      "type": "text",
      "id": "status_text",
      "label": "t:sections.password.settings.status_text.label",
      "default": "Coming Soon"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.password.settings.heading.label",
      "default": "Opening Soon"
    },
    {
      "type": "richtext",
      "id": "message",
      "label": "t:sections.password.settings.message.label",
      "default": "<p>We're working hard to bring you something special. Stay tuned!</p>"
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__countdown"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "t:sections.password.settings.show_countdown.label",
      "default": false
    },
    {
      "type": "text",
      "id": "launch_date",
      "label": "t:sections.password.settings.launch_date.label",
      "info": "t:sections.password.settings.launch_date.info",
      "placeholder": "2025-12-31T00:00:00"
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__email"
    },
    {
      "type": "checkbox",
      "id": "show_email_capture",
      "label": "t:sections.password.settings.show_email_capture.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.password.settings.header__social"
    },
    {
      "type": "checkbox",
      "id": "show_social_links",
      "label": "t:sections.password.settings.show_social_links.label",
      "info": "t:sections.password.settings.show_social_links.info",
      "default": true
    }
  ]
}
{% endschema %}
