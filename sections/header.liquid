{{ 'section-header.css' | asset_url | stylesheet_tag }}
<script src="{{ 'search-engine.js' | asset_url }}" defer></script>

{%- comment -%}
  üïê LIVE VERSION TIMESTAMP: {{ 'now' | date: '%Y-%m-%d %H:%M:%S' }}
  Deployed: {{ 'now' | date: '%Y-%m-%d at %H:%M:%S UTC' }}
{%- endcomment -%}

<header class="site-header" id="shopify-section-header" data-section-id="{{ section.id }}" data-sticky="{{ section.settings.enable_sticky_header }}" data-version="{{ 'now' | date: '%Y%m%d-%H%M%S' }}">
  <div class="site-header__container container">
    {%- # Logo -%}
    {%- if section.settings.show_logo -%}
      <div class="site-header__logo">
        {%- if request.page_type == 'index' -%}
          <h1 class="header__heading">
        {%- endif -%}
            <a href="{{ routes.root_url }}" class="logo-link" aria-label="{{ shop.name }}">
              {%- if section.settings.logo != blank -%}
                {%- # Custom logo from theme settings -%}
                {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
                {%- assign logo_height = section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio -%}
                {%- capture sizes -%}(max-width: {{ section.settings.logo_width | times: 2 }}px) 50vw, {{ section.settings.logo_width }}px{%- endcapture -%}
                {%- capture widths -%}{{ section.settings.logo_width }}, {{ section.settings.logo_width | times: 1.5 | round }}, {{ section.settings.logo_width | times: 2 }}{%- endcapture -%}
                {{ section.settings.logo | image_url: width: 600 | image_tag:
                  class: 'logo-image',
                  widths: widths,
                  height: logo_height,
                  width: section.settings.logo_width,
                  alt: logo_alt,
                  sizes: sizes,
                  loading: 'eager',
                  fetchpriority: 'high'
                }}
              {%- else -%}
                {%- # EMMSO default logo from assets -%}
                <picture>
                  <source 
                    type="image/webp"
                    srcset="{{ 'emmso-logo-homepage.webp' | asset_url }} 1x,
                            {{ 'emmso-logo-homepage.webp' | asset_url }} 2x"
                  >
                  <img 
                    src="{{ 'emmso-logo-homepage.webp' | asset_url }}"
                    alt="EMMSO - European Marketplace for Smart Shopping"
                    class="logo-image"
                    width="200"
                    height="56"
                    loading="eager"
                    fetchpriority="high"
                  >
                </picture>
              {%- endif -%}
            </a>
        {%- if request.page_type == 'index' -%}
          </h1>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- # Spacer to push icons right -%}
    <div style="flex: 1;"></div>

    {%- # Search Bar -%}
    {%- if section.settings.show_search_bar -%}
      <div class="site-header__search">
        {% render 'search-bar-compact' %}
      </div>
    {%- endif -%}

    {%- # Language Selector -%}
    {%- if section.settings.show_language_selector -%}
      <div class="site-header__language hide-mobile">
        {% render 'language-selector' %}
      </div>
    {%- endif -%}

    {%- # Icons -%}
    <div class="site-header__icons">
      {%- # Account -%}
      {%- if section.settings.show_account_link and shop.customer_accounts_enabled -%}
        <a href="{{ routes.account_url }}" class="icon-button" aria-label="{{ 'customer.account.title' | t }}">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      {%- endif -%}

      {%- # Cart -%}
      {%- if section.settings.show_cart_icon -%}
        <a href="{{ routes.cart_url }}" class="icon-button icon-button--cart" aria-label="{{ 'general.cart.title' | t }} ({{ cart.item_count }})">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" aria-hidden="true" focusable="false">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          {%- if cart.item_count > 0 -%}
            <span class="cart-count">{{ cart.item_count }}</span>
          {%- endif -%}
        </a>
      {%- endif -%}
    </div>
  </div>
</header>

{%- # Sticky Header JavaScript -%}
{%- if section.settings.enable_sticky_header -%}
  <script>
    class StickyHeader extends HTMLElement {
      constructor() {
        super();
        this.header = document.querySelector('.site-header');
        this.headerBounds = {};
        this.currentScrollTop = 0;
        this.preventReveal = false;

        this.onScrollHandler = this.onScroll.bind(this);
        window.addEventListener('scroll', this.onScrollHandler, false);
        this.createObserver();
      }

      createObserver() {
        let observer = new IntersectionObserver((entries, observer) => {
          this.headerBounds = entries[0].intersectionRect;
          observer.disconnect();
        });
        observer.observe(this.header);
      }

      onScroll() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
          if (!this.preventReveal) {
            requestAnimationFrame(() => {
              this.header.classList.add('sticky-header--hidden');
            });
          }
        } else if (scrollTop < this.currentScrollTop && scrollTop > this.headerBounds.bottom) {
          requestAnimationFrame(() => {
            this.header.classList.remove('sticky-header--hidden');
          });
        }

        this.currentScrollTop = scrollTop;
      }
    }

    customElements.define('sticky-header', StickyHeader);
  </script>
{%- endif -%}

{%- # Set CSS custom properties from section settings -%}
{%- style -%}
  :root {
    --header-border-color: {{ section.settings.border_color | default: '#FBB03B' }};
    --logo-height: {{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio | default: 48 }}px;
    --logo-height-mobile: {{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio | times: 0.75 | default: 36 }}px;
  }

  .site-header {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  @media (max-width: 768px) {
    .site-header {
      padding-top: calc({{ section.settings.padding_top }}px * 0.75);
      padding-bottom: calc({{ section.settings.padding_bottom }}px * 0.75);
    }
  }
{%- endstyle -%}

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "checkbox",
      "id": "show_logo",
      "label": "Show logo",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image",
      "info": "Recommended: 200px √ó 100px"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Logo width",
      "default": 150
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "show_language_selector",
      "label": "Show language selector",
      "default": true,
      "info": "Only displays if multiple languages are enabled"
    },
    {
      "type": "checkbox",
      "id": "show_account_link",
      "label": "Show account link",
      "default": true,
      "info": "Only displays if customer accounts are enabled"
    },
    {
      "type": "checkbox",
      "id": "show_cart_icon",
      "label": "Show cart icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search_bar",
      "label": "Show search bar",
      "default": true
    },
    {
      "type": "header",
      "content": "Sticky header"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "label": "Enable sticky header",
      "default": true,
      "info": "Header will remain visible when scrolling"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#FBB03B"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 16
    }
  ]
}
{% endschema %}
