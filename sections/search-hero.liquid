{% comment %}
  Search-First Hero Section
  Ultra-fast search engine as primary homepage element
  Performance-optimized with predictive search and instant results
  Refactored following Shopify best practices
{% endcomment %}

{{ 'section-search-hero.css' | asset_url | stylesheet_tag }}
{{ 'component-predictive-search.css' | asset_url | stylesheet_tag }}
<script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'search-hero.js' | asset_url }}" defer></script>

{%- # Set CSS custom properties from section settings -%}
{%- style -%}
  #shopify-section-{{ section.id }} {
    --search-hero-gradient-start: {{ section.settings.gradient_color_1 | default: '#FBB03B' }};
    --search-hero-gradient-mid: {{ section.settings.gradient_color_2 | default: '#FF8C42' }};
    --search-hero-gradient-end: {{ section.settings.gradient_color_3 | default: '#FBB03B' }};
    --search-hero-min-height: {{ section.settings.section_height }}vh;
  }
{%- endstyle -%}

<section class="search-hero" id="shopify-section-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="search-hero">
  <div class="search-hero__container">
    
    {%- # Headline -%}
    <div class="search-hero__header">
      <h1 class="search-hero__title">{{ section.settings.headline }}</h1>
      {%- if section.settings.subheadline != blank -%}
        <p class="search-hero__subtitle">{{ section.settings.subheadline }}</p>
      {%- endif -%}
    </div>

    {%- # Search Engine -%}
    <div class="search-hero__search">
      
      {%- # Market Category Filters -%}
      {%- if section.settings.show_categories -%}
        <div class="search-categories" role="group" aria-label="{{ 'general.search.categories' | t }}">
          {%- assign categories = section.settings.category_list | split: ',' -%}
          {%- for category in categories -%}
            {%- assign cat_clean = category | strip -%}
            <button 
              type="button" 
              class="category-pill" 
              data-category="{{ cat_clean | handleize }}"
              aria-label="{{ 'general.search.filter_by' | t }} {{ cat_clean }}"
            >
              {{ cat_clean }}
            </button>
          {%- endfor -%}
        </div>
      {%- endif -%}

      <form action="{{ routes.search_url }}" method="get" class="search-form" role="search" aria-label="{{ 'general.search.title' | t }}">
        
        <predictive-search>
          {%- # Search Input -%}
          <div class="search-input-wrapper">
            <label for="search-hero-input" class="visually-hidden">{{ 'general.search.placeholder' | t }}</label>
            <input 
              type="search" 
              name="q" 
              id="search-hero-input"
              class="search-input"
              placeholder="{{ section.settings.search_placeholder }}"
              autocomplete="off"
              autocapitalize="off"
              spellcheck="false"
              aria-label="{{ 'general.search.placeholder' | t }}"
              aria-describedby="search-hero-desc"
            >
            <span id="search-hero-desc" class="visually-hidden">{{ 'general.search.description' | t }}</span>
          
          {%- # Search Icon -%}
          <button type="submit" class="search-submit" aria-label="{{ 'general.search.submit' | t }}">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          {%- # Voice Search (if enabled) -%}
          {%- if section.settings.enable_voice_search -%}
            <button type="button" class="search-voice" aria-label="{{ 'general.search.voice' | t }}" data-voice-search-button title="{{ 'general.search.voice' | t }}">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" fill="currentColor"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 19v4M8 23h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          {%- endif -%}

          {%- # Clear Button -%}
          <button type="button" class="search-clear" aria-label="{{ 'general.search.clear' | t }}" data-search-clear hidden>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        {%- # Predictive Search Results -%}
        <div class="search-results" data-predictive-search-results hidden></div>
      </predictive-search>
      </form>

      {%- # Search Suggestions (Trending/Recent) -%}
      {%- if section.settings.show_suggestions -%}
        <div class="search-suggestions" data-search-suggestions>
          
          {%- # Recent Searches -%}
          <div class="search-suggestions__recent" data-recent-searches hidden>
            <h3 class="search-suggestions__title">{{ 'general.search.recent' | t }}</h3>
            <ul class="search-suggestions__list" data-recent-list></ul>
          </div>

          {%- # Trending Searches -%}
          {%- if section.settings.trending_searches != blank -%}
            <div class="search-suggestions__trending">
              <h3 class="search-suggestions__title">{{ 'general.search.trending' | t }}</h3>
              <ul class="search-suggestions__list">
                {%- assign trending = section.settings.trending_searches | split: ',' -%}
                {%- for term in trending -%}
                  <li>
                    <button type="button" class="search-suggestion-chip" data-suggestion="{{ term | strip }}" aria-label="{{ 'general.search.search_for' | t }} {{ term | strip }}">
                      {{ term | strip }}
                    </button>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}

        </div>
      {%- endif -%}

    </div>

    {%- # Quick Stats (Optional) -%}
    {%- if section.settings.show_stats -%}
      <div class="search-hero__stats" role="group" aria-label="{{ 'general.search.stats' | t }}">
        <div class="stat">
          <span class="stat__number" aria-label="{{ all_products_count | default: '10,000+' }} {{ 'general.search.products' | t }}">{{ all_products_count | default: '10,000+' }}</span>
          <span class="stat__label">{{ 'general.search.products' | t }}</span>
        </div>
        <div class="stat">
          <span class="stat__number" aria-label="{{ section.settings.brand_count | default: '19' }} {{ 'general.search.brands' | t }}">{{ section.settings.brand_count | default: '19' }}</span>
          <span class="stat__label">{{ 'general.search.brands' | t }}</span>
        </div>
        <div class="stat">
          <span class="stat__number" aria-label="{{ section.settings.market_count | default: '10' }} {{ 'general.search.markets' | t }}">{{ section.settings.market_count | default: '10' }}</span>
          <span class="stat__label">{{ 'general.search.markets' | t }}</span>
        </div>
      </div>
    {%- endif -%}

  </div>
</section>

{% schema %}
{
  "name": "Search Hero",
  "tag": "section",
  "class": "section-search-hero",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Headline",
      "default": "Find Your Perfect Solution"
    },
    {
      "type": "textarea",
      "id": "subheadline",
      "label": "Subheadline",
      "default": "Discover thousands of premium products across all markets",
      "info": "Keep this generic and timeless - describe the breadth without listing specific markets"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder text",
      "default": "Search products, brands, categories..."
    },
    {
      "type": "header",
      "content": "Gradient colors"
    },
    {
      "type": "color",
      "id": "gradient_color_1",
      "label": "Gradient start color",
      "default": "#FBB03B",
      "info": "Left side of gradient"
    },
    {
      "type": "color",
      "id": "gradient_color_2",
      "label": "Gradient middle color",
      "default": "#FF8C42",
      "info": "Center of gradient"
    },
    {
      "type": "color",
      "id": "gradient_color_3",
      "label": "Gradient end color",
      "default": "#FBB03B",
      "info": "Right side of gradient"
    },
    {
      "type": "header",
      "content": "Search features"
    },
    {
      "type": "checkbox",
      "id": "show_categories",
      "label": "Show category filters",
      "default": true,
      "info": "Display market category pills above search"
    },
    {
      "type": "textarea",
      "id": "category_list",
      "label": "Category list",
      "default": "Floors, Walls, Bathrooms, Kitchens, Outdoor, Tools & Adhesives",
      "info": "Comma-separated list of product categories/markets"
    },
    {
      "type": "checkbox",
      "id": "enable_voice_search",
      "label": "Enable voice search",
      "default": false,
      "info": "Requires browser support for Web Speech API"
    },
    {
      "type": "checkbox",
      "id": "show_suggestions",
      "label": "Show search suggestions",
      "default": true
    },
    {
      "type": "textarea",
      "id": "trending_searches",
      "label": "Trending searches",
      "default": "bathroom tiles, kitchen faucets, wall panels, outdoor pavers, adhesives, sealants",
      "info": "Comma-separated list of trending search terms"
    },
    {
      "type": "header",
      "content": "Statistics"
    },
    {
      "type": "checkbox",
      "id": "show_stats",
      "label": "Show statistics",
      "default": true
    },
    {
      "type": "text",
      "id": "brand_count",
      "label": "Number of brands",
      "default": "19"
    },
    {
      "type": "text",
      "id": "market_count",
      "label": "Number of markets",
      "default": "10"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "section_height",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "label": "Section height",
      "default": 80,
      "info": "Height of the hero section (viewport height)"
    }
  ],
  "presets": [
    {
      "name": "Search Hero",
      "settings": {
        "headline": "Find Your Perfect Solution",
        "subheadline": "Search thousands of products across floors, walls, bathrooms, kitchens & more"
      }
    }
  ]
}
{% endschema %}
