class SearchIntelligence{constructor(){this.synonyms ={'laminate':['laminaat','laminat','laminated flooring','laminate floor','stratifié'],'vinyl':['pvc','luxury vinyl','lvt','vinyl plank','vinyl planks','vinyle'],'parquet':['parket','parkett','hardwood','wood flooring','houten vloer'],'wood':['wooden','timber','hout','holz','bois','legno','madera'],'tile':['tiles','tegel','tegels','fliese','fliesen','carrelage','piastrelle','azulejo'],'stone':['steen','stein','natural stone','marble','granite','pierre','pietra','piedra'],'cleaner':['cleaning','clean','reiniger','reinigung','schoonmaakmiddel','schoonmaak','nettoyant','detergente','limpiador'],'sealer':['sealing','seal','verzegeling','versiegelung','scellant','sigillante','sellador','protection'],'oil':['olie','öl','wood oil','floor oil','huile','olio','aceite'],'wax':['was','wachs','floor wax','cire','cera'],'polish':['polisher','polijsten','polieren','polir','lucidare','pulir'],'adhesive':['glue','lijm','kleber','colle','colla','pegamento','bonding'],'underlay':['underlayment','ondervloer','unterlage','sous-couche','sottofondi'],'varnish':['vernis','lak','lack','vernice','barniz'],'waterproof':['water resistant','waterdicht','wasserdicht','water proof','étanche','impermeabile','impermeable'],'scratch resistant':['scratch proof','krasbestendig','kratzfest','résistant aux rayures','antigraffio','resistente a los arañazos'],'easy to install':['diy','click system','gemakkelijk te leggen','einfach zu verlegen','facile à poser','facile da installare','fácil de instalar'],'durable':['strong','heavy duty','duurzaam','langlebig','robust','durable','durevole','duradero'],'eco friendly':['ecological','sustainable','milieuvriendelijk','umweltfreundlich','écologique','ecologico','ecológico'],'bona':['bona floor care','bona products','bona vloeronderhoud'],'woca':['woca denmark','woca oil','woca olie'],'lithofin':['lithofin stone care','lithofin natuursteen'],'hmk':['hmk moeller','hmk stone care'],'loba':['loba wakol','loba vloeren'],'quick-step':['quick step','quickstep'],'blue dolphin':['bluedolphin','blue dolfijn'],'oak':['eik','eiche','oak wood','chêne','quercia','roble'],'walnut':['noot','walnuss','walnut wood','noyer','noce','nogal'],'white':['wit','weiss','whitewashed','blanc','bianco','blanco'],'grey':['gray','grijs','grau','gris','grigio'],'brown':['bruin','braun','brun','marrone','marrón'],'black':['zwart','schwarz','noir','nero','negro'],'natural':['naturel','natur','natural finish','naturale','natural'],'matt':['matte','mat','matt finish'],'gloss':['glossy','high gloss','glanzend','glänzend','brillant','lucido','brillante'],'beige':['beige','crème','crema'],'kitchen':['keuken','küche','cuisine','cucina','cocina'],'bathroom':['badkamer','bad','salle de bain','bagno','baño','douche','wc'],'living room':['woonkamer','salon','wohnzimmer','soggiorno','sala de estar'],'bedroom':['slaapkamer','schlafzimmer','chambre','camera da letto','dormitorio'],'hallway':['gang','hal','flur','couloir','corridoio','pasillo','entree'],'install':['installation','leggen','verlegen','installeren','poser','installare','instalar'],'maintain':['maintenance','onderhoud','onderhouden','pflege','pflegen','entretien','manutenzione','mantenimiento'],'clean':['cleaning','schoonmaken','reinigen','nettoyer','pulire','limpiar'],'protect':['protection','beschermen','schützen','protéger','proteggere','proteger'],'restore':['restoration','herstellen','wiederherstellen','restaurer','restaurare','restaurar']};this.questionPatterns ={how:/^(how|hoe|wie)\s+(to|can|do|te)\s+/i,what:/^(what|wat|welke|welches?)\s+/i,which:/^(which|welke|welches?)\s+/i,where:/^(where|waar|wo)\s+/i,when:/^(when|wanneer|wann)\s+/i,why:/^(why|waarom|warum)\s+/i,best:/\b(best|beste|besten?)\b/i,cheap:/\b(cheap|goedkoop|billig|affordable|budget)\b/i,recommend:/\b(recommend|aanbevelen|empfehlen|suggestion)\b/i};this.problemKeywords = [ 'remove','fix','repair','clean','maintain','protect','prevent','verwijder','herstel','repareer','schoon','onderhoud','bescherm','entfernen','reparieren','reinigen','pflegen','schützen','stain','scratch','damage','crack','squeak','water damage','vlek','kras','schade','barst','piepen','waterschade' ];this.roomTypes ={kitchen:['keuken','küche','cuisine','cucina'],bathroom:['badkamer','bad','salle de bain','bagno'],living:['woonkamer','wohnzimmer','salon','soggiorno','living room'],bedroom:['slaapkamer','schlafzimmer','chambre','camera da letto'],hallway:['gang','flur','couloir','corridoio','entrance'],outdoor:['buiten','außen','extérieur','esterno','terrace','balcony']};this.usageCharacteristics ={'pet-friendly':['pet safe','huisdier','haustier','animal','dog','cat'],'underfloor heating':['vloerverwarming','fußbodenheizung','chauffage sol','ufh'],'high traffic':['commercial','heavy duty','zwaar gebruik','stark beansprucht'],'moisture resistant':['waterproof','water resistant','vochtbestendig','feuchtigkeitsbeständig']};}analyzeQuery(query){const analysis ={original:query,normalized:this.normalizeQuery(query),intent:this.detectIntent(query),synonyms:this.expandSynonyms(query),room:this.detectRoom(query),characteristics:this.detectCharacteristics(query),isQuestion:this.isQuestion(query),isProblem:this.isProblem(query),brands:this.detectBrands(query),colors:this.detectColors(query),priceRange:this.extractPriceRange(query)};return analysis;}normalizeQuery(query){return query .toLowerCase().trim().replace(/[^\w\s€$-]/g,' ').replace(/\s+/g,' ');}detectIntent(query){const normalized = this.normalizeQuery(query);for(const [type,pattern] of Object.entries(this.questionPatterns)){if(pattern.test(normalized)){return type;}}if(this.isProblem(normalized)){return 'problem-solving';}if(/\bvs\b|\bversus\b|\bor\b|\bof\b/.test(normalized)){return 'comparison';}if(/\bbuy\b|\bkoop\b|\bkaufen\b|\bpurchase\b/.test(normalized)){return 'purchase';}return 'search';}isQuestion(query){return Object.values(this.questionPatterns).some(pattern => pattern.test(query))|| query.includes('?');}isProblem(query){const normalized = this.normalizeQuery(query);return this.problemKeywords.some(keyword => normalized.includes(keyword));}expandSynonyms(query){const normalized = this.normalizeQuery(query);const expanded = new Set([normalized]);for(const [base,syns] of Object.entries(this.synonyms)){if(normalized.includes(base)|| syns.some(syn => normalized.includes(syn))){expanded.add(base);syns.forEach(syn => expanded.add(syn));}}return Array.from(expanded);}detectRoom(query){const normalized = this.normalizeQuery(query);for(const [room,keywords] of Object.entries(this.roomTypes)){if(keywords.some(keyword => normalized.includes(keyword))|| normalized.includes(room)){return room;}}return null;}detectCharacteristics(query){const normalized = this.normalizeQuery(query);const characteristics = [];for(const [char,keywords] of Object.entries(this.usageCharacteristics)){if(keywords.some(keyword => normalized.includes(keyword))|| normalized.includes(char)){characteristics.push(char);}}return characteristics;}detectBrands(query){const normalized = this.normalizeQuery(query);const brands = [ 'lithofin','hmk','lecol','woca','bona','loba','floorservice','blue dolphin','dr. schutz','blanchon','quick-step','pergo','berry alloc','parador','haro','osmo','treatex','rubio monocoat','pallmann' ];return brands.filter(brand => normalized.includes(brand));}detectColors(query){const normalized = this.normalizeQuery(query);const colors = [];const colorMap ={'oak':['eik','eiche'],'walnut':['noot','walnuss'],'white':['wit','weiss'],'grey':['grijs','grau','gray'],'brown':['bruin','braun'],'black':['zwart','schwarz'],'natural':['naturel','natur']};for(const [color,variants] of Object.entries(colorMap)){if(normalized.includes(color)|| variants.some(v => normalized.includes(v))){colors.push(color);}}return colors;}extractPriceRange(query){const pricePatterns = [ /(?:under|below|less than|max|maximum)\s*€?\s*(\d+)/i,/€?\s*(\d+)\s*(?:to|-|tot)\s*€?\s*(\d+)/i,/(?:over|above|more than|min|minimum)\s*€?\s*(\d+)/i ];for(const pattern of pricePatterns){const match = query.match(pattern);if(match){if(pattern.source.includes('under|below')){return{max:parseInt(match[1])};}else if(pattern.source.includes('to|-|tot')){return{min:parseInt(match[1]),max:parseInt(match[2])};}else if(pattern.source.includes('over|above')){return{min:parseInt(match[1])};}}}return null;}rankResults(results,query,analysis){return results.map(product =>{let score = 0;if(product.title.toLowerCase().includes(query.toLowerCase())){score += 100;}if(analysis.synonyms.some(syn => product.title.toLowerCase().includes(syn.toLowerCase()))){score += 80;}if(analysis.brands.length > 0 && analysis.brands.some(brand => product.vendor?.toLowerCase().includes(brand.toLowerCase()))){score += 60;}const productTags = product.tags || [];if(analysis.characteristics.some(char => productTags.some(tag => tag.toLowerCase().includes(char.toLowerCase())))){score += 50;}if(analysis.room && productTags.some(tag => tag.toLowerCase().includes(analysis.room))){score += 40;}if(analysis.priceRange){const price = product.price / 100;const inRange =(!analysis.priceRange.min || price >= analysis.priceRange.min)&&(!analysis.priceRange.max || price <= analysis.priceRange.max);if(inRange)score += 30;}if(product.available){score += 20;}if(productTags.some(tag => tag.toLowerCase()=== 'new')){score += 10;}return{...product,relevanceScore:score};}).sort((a,b)=> b.relevanceScore - a.relevanceScore);}generateSmartSuggestions(query,analysis){const suggestions = [];if(analysis.isQuestion){suggestions.push({type:'info',text:'Looking for how-to guides? Check our learning center',action:'/pages/learning-center'});}if(analysis.isProblem){suggestions.push({type:'category',text:'Browse all floor care products',action:'/collections/floor-care'});}if(analysis.room){suggestions.push({type:'category',text:`See all ${analysis.room}flooring options`,action:`/collections/${analysis.room}-flooring`});}if(analysis.brands.length > 0){analysis.brands.forEach(brand =>{suggestions.push({type:'brand',text:`View all ${brand}products`,action:`/collections/vendor-${brand.toLowerCase().replace(/\s+/g,'-')}`});});}return suggestions;}getQueryVariations(query){const analysis = this.analyzeQuery(query);const variations = new Set([query,analysis.normalized]);analysis.synonyms.forEach(syn =>{if(syn !== query && syn.length >= 2){variations.add(syn);}});const withoutPrice = query.replace(/€?\s*\d+(?:\s*(?:to|-|tot)\s*€?\s*\d+)?/gi,'').trim();if(withoutPrice !== query && withoutPrice.length >= 2){variations.add(withoutPrice);}if(analysis.brands.length > 0){analysis.brands.forEach(brand => variations.add(brand));}if(analysis.colors.length > 0){analysis.colors.forEach(color => variations.add(color));}if(analysis.room){variations.add(analysis.room);variations.add(`${analysis.room}flooring`);}return Array.from(variations).filter(v => v.length >= 2);}getRelatedProductsQuery(product,currentLanguage = 'en'){const queries = [];if(product.product_type){queries.push(product.product_type);const type = product.product_type.toLowerCase();if(this.synonyms[type]){queries.push(...this.synonyms[type]);}}if(product.vendor){queries.push(product.vendor);}if(product.tags){product.tags.forEach(tag =>{const tagLower = tag.toLowerCase();for(const [char,keywords] of Object.entries(this.usageCharacteristics)){if(keywords.some(k => tagLower.includes(k))|| tagLower.includes(char)){queries.push(char);}}});}const titleWords = product.title.toLowerCase().split(/\s+/);titleWords.forEach(word =>{for(const [color,variants] of Object.entries(this.getColorMap())){if(word === color || variants.some(v => word.includes(v))){queries.push(color);}}});return queries.filter((v,i,a)=> a.indexOf(v)=== i).slice(0,3);}getColorMap(){return{'oak':['eik','eiche','chêne'],'walnut':['noot','walnuss','noyer'],'white':['wit','weiss','blanc','bianco'],'grey':['grijs','grau','gris','grigio','gray'],'brown':['bruin','braun','brun','marrone'],'black':['zwart','schwarz','noir','nero'],'natural':['naturel','natur','naturale'],'beige':['beige'],'red':['rood','rot','rouge','rosso']};}detectLanguage(){const htmlLang = document.documentElement.lang;if(htmlLang){return htmlLang.split('-')[0].toLowerCase();}const pathLang = window.location.pathname.match(/^\/([a-z]{2})\ if(pathLang){return pathLang[1].toLowerCase();}if(window.Shopify?.locale){return window.Shopify.locale.split('-')[0].toLowerCase();}return 'en';}getLocalizedPlaceholder(){const lang = this.detectLanguage();const placeholders ={'nl':'Zoek naar producten,merken of categorieën...','de':'Suchen Sie nach Produkten,Marken oder Kategorien...','fr':'Rechercher des produits,marques ou catégories...','es':'Buscar productos,marcas o categorías...','it':'Cerca prodotti,marchi o categorie...','pt':'Pesquisar produtos,marcas ou categorias...','da':'Søg efter produkter,mærker eller kategorier...','en':'Search for products,brands,or categories...'};return placeholders[lang] || placeholders['en'];}}window.SearchIntelligence = SearchIntelligence;